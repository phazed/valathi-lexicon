<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Vrahune Toolbox – Generators & Lexicons</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    :root {
      --bg-main: #050608;
      --bg-panel: #0b0f14;
      --bg-panel-alt: #090d11;
      --bg-nav: #050608;
      --border-subtle: #232a33;
      --accent: #c0c0c0;
      --accent-soft: #808890;
      --accent-strong: #f5f5f5;
      --danger: #ff5c5c;
      --text-main: #e6e6e6;
      --text-muted: #9ba1aa;
      --hover: #151a22;
      --shadow-soft: 0 0 24px rgba(0, 0, 0, 0.7);
      --radius-lg: 14px;
      --radius-md: 10px;
      --radius-sm: 6px;
      --transition-fast: 0.16s ease-out;
    }

    * {
      box-sizing: border-box;
    }

    html {
      height: 100%;
      overflow-y: scroll;
    }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text",
                   "Segoe UI", sans-serif;
      background: radial-gradient(circle at top left, #151921 0, #050608 40%, #000000 100%);
      color: var(--text-main);
      height: 100vh;
      display: flex;
      flex-direction: column;
      -webkit-font-smoothing: antialiased;
    }

    *::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }
    *::-webkit-scrollbar-track {
      background: #050608;
    }
    *::-webkit-scrollbar-thumb {
      background: #2c323d;
      border-radius: 4px;
    }
    *::-webkit-scrollbar-thumb:hover {
      background: #3a414d;
    }

    .app-shell {
      display: flex;
      flex-direction: column;
      height: 100vh;
      max-width: 1400px;
      width: 100%; /* keep outer width stable */
      margin: 0 auto;
      padding: 10px 12px;
      gap: 8px;
    }

    header.app-header {
      background: linear-gradient(135deg, #0b0f14, #050608);
      border-radius: var(--radius-lg);
      border: 1px solid var(--border-subtle);
      box-shadow: var(--shadow-soft);
      padding: 10px 14px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      flex: 0 0 auto;
    }

    .header-left {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .app-title {
      font-size: 1.1rem;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      color: var(--accent-strong);
    }

    .app-subtitle {
      font-size: 0.78rem;
      color: var(--text-muted);
    }

    .header-right {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 0.8rem;
    }

    .badge {
      padding: 2px 8px;
      border-radius: 999px;
      border: 1px solid var(--border-subtle);
      background: #05090f;
      color: var(--accent-soft);
    }

    .btn-primary,
    .btn-secondary,
    .btn-small {
      font-family: inherit;
      font-size: 0.8rem;
      border-radius: 999px;
      border: 1px solid transparent;
      padding: 6px 12px;
      cursor: pointer;
      background: #181f2b;
      color: var(--accent-strong);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 4px;
      transition:
        background var(--transition-fast),
        border-color var(--transition-fast),
        transform 0.06s ease-out,
        box-shadow 0.06s ease-out;
    }

    .btn-primary {
      border-color: #818894;
      background: radial-gradient(circle at top, #2a303b, #141821);
    }

    .btn-primary:hover {
      background: radial-gradient(circle at top, #343b46, #171a24);
      box-shadow: 0 0 12px rgba(192, 192, 192, 0.25);
      transform: translateY(-0.5px);
    }

    .btn-secondary {
      border-color: #303641;
      background: #080b11;
      color: var(--text-muted);
    }

    .btn-secondary:hover {
      border-color: #3a414d;
      background: #10141d;
      transform: translateY(-0.5px);
    }

    .btn-small {
      font-size: 0.76rem;
      padding: 3px 8px;
      border-radius: 999px;
    }

    .toggle-active {
      background: #181f2b !important;
      color: var(--accent-strong) !important;
      border-color: #6d7584 !important;
    }

    .layout-main {
      display: grid;
      grid-template-columns: 270px minmax(0, 1fr);
      gap: 10px;
      flex: 1 1 auto;
      min-height: 0;
      align-items: stretch;
    }

    aside.sidebar {
      background: var(--bg-nav);
      border-radius: var(--radius-lg);
      border: 1px solid var(--border-subtle);
      box-shadow: var(--shadow-soft);
      padding: 8px 6px;
      display: flex;
      flex-direction: column;
      gap: 6px;
      min-height: 0;
      overflow-y: auto;
    }

    .sidebar-section {
      border-radius: var(--radius-md);
      border: 1px solid var(--border-subtle);
      background: #050608;
      padding: 6px 6px 8px;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    #sidebarGeneratorsSection {
      flex: 0 0 auto;
    }

    .sidebar-header {
      display: flex;
      flex-direction: column;
      gap: 6px;
      padding: 0 4px;
    }

    .sidebar-header-row {
      display: flex;
      gap: 6px;
      align-items: center;
      justify-content: space-between;
    }

    .sidebar-title {
      font-size: 0.85rem;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      color: var(--accent-soft);
    }

    .sidebar-subtitle {
      font-size: 0.7rem;
      color: var(--text-muted);
    }

    .search-input {
      width: 100%;
      padding: 5px 10px;
      border-radius: 999px;
      border: 1px solid var(--border-subtle);
      background: #05070c;
      color: var(--text-main);
      font-size: 0.78rem;
    }

    .search-input:focus {
      outline: none;
      border-color: #9aa2af;
      box-shadow: 0 0 0 1px rgba(192,192,192,0.4);
    }

    .nav-scroll {
      margin-top: 4px;
      padding: 0 2px;
    }

    .tools-nav {
      margin-top: 4px;
      padding: 0 2px;
    }

    .nav-folder-heading {
      font-size: 0.78rem;
      padding: 3px 6px;
      margin-top: 4px;
      border-radius: var(--radius-md);
      background: linear-gradient(90deg, #070b11, #050608);
      border: 1px solid rgba(59, 69, 83, 0.9);
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 4px;
      cursor: pointer;
    }

    .folder-toggle {
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .folder-arrow {
      color: var(--accent-soft);
      font-size: 0.7rem;
    }

    .folder-label {
      color: var(--accent-strong);
    }

    .folder-badge {
      font-size: 0.7rem;
      padding: 0 4px;
      border-radius: 999px;
      border: 1px solid #3b4656;
      color: var(--text-muted);
    }

    .folder-rename-btn {
      padding: 2px 6px;
      font-size: 0.7rem;
    }

    .nav-generator {
      font-size: 0.78rem;
      padding: 3px 10px 3px 22px;
      border-radius: var(--radius-md);
      cursor: pointer;
      margin-top: 1px;
      color: var(--text-muted);
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 4px;
    }

    .nav-generator:hover {
      background: #151a22;
      color: var(--accent-strong);
    }

    .nav-generator.active {
      background: linear-gradient(135deg, #1f2835, #101720);
      color: var(--accent-strong);
      border: 1px solid #6d7584;
    }

    .nav-generator .name {
      white-space: nowrap;
      text-overflow: ellipsis;
      overflow: hidden;
      max-width: 100%;
    }

    .nav-tool {
      font-size: 0.78rem;
      padding: 4px 8px;
      border-radius: var(--radius-md);
      cursor: pointer;
      margin-top: 2px;
      color: var(--text-muted);
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 4px;
    }

    .nav-tool:hover {
      background: #151a22;
      color: var(--accent-strong);
    }

    .nav-tool.active {
      background: linear-gradient(135deg, #1f2835, #101720);
      color: var(--accent-strong);
      border: 1px solid #6d7584;
    }

    section.main-panel {
      background: var(--bg-panel);
      border-radius: var(--radius-lg);
      border: 1px solid var(--border-subtle);
      box-shadow: var(--shadow-soft);
      padding: 10px 12px;
      display: flex;
      flex-direction: column;
      min-height: 0;
    }

    .generator-panel-wrapper {
      flex: 1 1 auto;
      min-height: 0;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    #activeGeneratorLabel {
      font-size: 0.9rem;
      color: var(--accent-strong);
      flex: 0 0 auto;
    }

    #generatorPanel {
      border-radius: var(--radius-md);
      border: 1px solid #222832;
      background: radial-gradient(circle at top left, #10151f, #05070c 70%);
      padding: 10px 10px;
      font-size: 0.8rem;
      display: flex;
      flex-direction: column;
      gap: 6px;
      flex: 1 1 auto;
      min-height: 0;
      overflow-y: auto;
    }

    .row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 6px;
      align-items: flex-start;
    }

    .col {
      flex: 1;
      min-width: 120px;
    }

    label {
      display: block;
      font-size: 0.75rem;
      color: var(--text-muted);
      margin-bottom: 3px;
    }

    input[type="number"],
    input[type="text"],
    select,
    textarea {
      width: 100%;
      font-family: inherit;
      font-size: 0.8rem;
      padding: 5px 8px;
      border-radius: var(--radius-sm);
      border: 1px solid var(--border-subtle);
      background: #05070c;
      color: var(--text-main);
    }

    textarea {
      resize: vertical;
      min-height: 80px;
    }

    input:focus,
    select:focus,
    textarea:focus {
      outline: none;
      border-color: #9aa2af;
      box-shadow: 0 0 0 1px rgba(192,192,192,0.4);
    }

    .generated-list {
      border-radius: var(--radius-md);
      border: 1px solid #222832;
      background: #05070c;
      padding: 6px 5px;
      font-family: "JetBrains Mono", "SF Mono", Menlo, Consolas, monospace;
      font-size: 0.78rem;
      flex: 1;
      overflow-y: auto;
      min-height: 60px;
      max-height: 260px;
    }

    .generated-item {
      padding: 2px 6px;
      border-radius: var(--radius-sm);
      cursor: pointer;
      margin-bottom: 2px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .generated-item:hover {
      background: #161b24;
    }

    .copy-tip {
      font-size: 0.75rem;
      color: var(--text-muted);
      padding: 2px 4px;
      border-radius: 999px;
      border: 1px solid #222832;
      background: #05070c;
      display: inline-flex;
      align-items: center;
      margin-top: 4px;
      max-width: 100%;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .muted {
      color: var(--text-muted);
    }

    hr {
      border: none;
      border-top: 1px solid #1a2028;
      margin: 6px 0;
    }

    .section-title {
      display: flex;
      align-items: center;
      justify-content: space-between;
      font-size: 0.8rem;
      color: var(--accent-soft);
      margin-bottom: 4px;
      gap: 6px;
    }

    .section-title span {
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .token-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.78rem;
      margin-top: 2px;
    }

    .token-table th,
    .token-table td {
      border: 1px solid #232a33;
      padding: 4px 6px;
      vertical-align: top;
    }

    .token-table th {
      background: #0b1017;
      color: var(--accent-soft);
      font-weight: 500;
      text-align: left;
    }

    .token-table td {
      background: #05070c;
    }

    .token-table select {
      width: 100%;
      font-size: 0.78rem;
      padding: 3px 6px;
      border-radius: var(--radius-sm);
    }

    .adv-tab-bar {
      display: inline-flex;
      border-radius: 999px;
      border: 1px solid #2d3440;
      overflow: hidden;
      margin-bottom: 4px;
      background: #05070c;
    }

    .adv-tab {
      font-size: 0.76rem;
      padding: 4px 10px;
      border: none;
      background: transparent;
      color: var(--text-muted);
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .adv-tab.active {
      background: #181f2b;
      color: var(--accent-strong);
    }

    .adv-tab:hover {
      background: #10141d;
    }

    .adv-token-advanced {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .adv-selected-chips {
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
      min-height: 22px;
    }

    .adv-chip {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 2px 6px;
      border-radius: 999px;
      border: 1px solid #3a414d;
      background: #10151f;
      font-size: 0.75rem;
      white-space: nowrap;
    }

    .adv-chip-remove {
      border: none;
      background: transparent;
      color: var(--text-muted);
      font-size: 0.8rem;
      cursor: pointer;
      padding: 0 2px;
    }

    .adv-chip-remove:hover {
      color: var(--danger);
    }

    .adv-search-input {
      font-size: 0.75rem;
      padding: 3px 6px;
    }

    .adv-search-results {
      font-size: 0.75rem;
      max-height: 110px;
      overflow-y: auto;
    }

    .adv-search-item {
      padding: 2px 4px;
      border-radius: 4px;
      cursor: pointer;
    }

    .adv-search-item:hover {
      background: #161b24;
      color: var(--accent-strong);
    }

    .toolbox-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 4px;
      margin-top: 4px;
      /* no flex:1 here so buttons sit under boxes */
    }

    .toolbox-col {
      display: flex;
      flex-direction: column;
      min-height: 0;
    }

    .toolbox-col textarea {
      min-height: 80px;
      max-height: 200px;
      font-size: 0.78rem;
      /* no flex:1 so row doesn't stretch to bottom */
    }

    .danger {
      color: var(--danger) !important;
    }

    .generator-create-box {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.78);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 999;
    }

    .generator-create-inner {
      width: 720px;
      max-width: 95vw;
      max-height: 90vh;
      background: #05070c;
      border-radius: var(--radius-lg);
      border: 1px solid #2b323e;
      box-shadow: var(--shadow-soft);
      padding: 10px 12px;
      font-size: 0.8rem;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .generator-create-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 4px;
      gap: 6px;
    }

    .generator-create-title {
      font-size: 0.9rem;
      color: var(--accent-strong);
      display: flex;
      align-items: center;
      gap: 6px;
      flex-wrap: wrap;
    }

    .generator-create-body {
      max-height: 60vh;
      overflow-y: auto;
      padding-right: 2px;
    }

    .items-expanded {
      max-height: 260px;
      min-height: 160px;
    }

    @media (max-width: 960px) {
      .layout-main {
        grid-template-columns: minmax(0, 1fr);
        grid-template-rows: auto auto;
      }
      aside.sidebar {
        order: 1;
      }
      section.main-panel {
        order: 2;
      }
      .toolbox-row {
        grid-template-columns: 1fr;
      }
    }

    code {
      font-family: "JetBrains Mono", "SF Mono", Menlo, Consolas, monospace;
      font-size: 0.75rem;
      background: rgba(255,255,255,0.02);
      border-radius: 4px;
      padding: 0 3px;
    }
  </style>
</head>
<body>
  <div class="app-shell">
    <header class="app-header">
      <div class="header-left">
        <div class="app-title">Vrahune Toolbox</div>
        <div class="app-subtitle">
          Local-only generators, lexicons, and templates for your world –
          everything lives in your browser until you export it.
        </div>
      </div>
      <div class="header-right">
        <span class="badge">Offline · Local Storage</span>

        <button id="downloadDbBtn" class="btn-secondary btn-small" type="button">
          ⬇ Download database
        </button>

        <button id="uploadDbBtn" class="btn-secondary btn-small" type="button">
          ⬆ Upload database
        </button>

        <button id="uploadDbHelpBtn" class="btn-secondary btn-small" type="button" title="What does upload do?">
          ?
        </button>
      </div>
    </header>

    <!-- Hidden file input for upload -->
    <input id="uploadDbFileInput" type="file" accept=".json" style="display:none;" />

    <div class="layout-main">
      <!-- LEFT: Generators / Folders + Tools -->
      <aside class="sidebar">
        <!-- Generators & Lexicons -->
        <div id="sidebarGeneratorsSection" class="sidebar-section">
          <div class="sidebar-header">
            <div class="sidebar-header-row">
              <div>
                <div class="sidebar-title">Generators & Lexicons</div>
                <div class="sidebar-subtitle">Click a generator to use it · folders for organization</div>
              </div>
              <button id="addGeneratorBtn" class="btn-primary btn-small" type="button">
                ＋ New
              </button>
            </div>
            <input
              id="generatorSearchInput"
              class="search-input"
              type="text"
              placeholder="Search generators..."
            />
          </div>
          <div id="generatorNav" class="nav-scroll"></div>
        </div>

        <!-- Tools box -->
        <div id="sidebarToolsSection" class="sidebar-section">
          <div class="sidebar-header">
            <div>
              <div class="sidebar-title">Tools</div>
              <div class="sidebar-subtitle">Format helpers & utilities</div>
            </div>
          </div>
          <input
            id="toolSearchInput"
            class="search-input"
            type="text"
            placeholder="Search tools..."
          />
          <div id="toolsNav" class="tools-nav"></div>
        </div>
      </aside>

      <!-- RIGHT: Active generator or tool -->
      <section class="main-panel">
        <div class="generator-panel-wrapper">
          <div id="activeGeneratorLabel">No generator or tool selected</div>
          <div id="generatorPanel">
            <div class="muted">Choose a generator or tool from the left, or click ＋ to create a new generator.</div>
          </div>
        </div>
      </section>
    </div>
  </div>

  <!-- Generator create / edit modal -->
  <div id="generatorCreateBox" class="generator-create-box">
    <div class="generator-create-inner">
      <div class="generator-create-header">
        <div class="generator-create-title">Create / Edit Generator</div>
        <button id="cancelGeneratorBtn" class="btn-secondary btn-small" type="button">
          ✕ Close
        </button>
      </div>
      <div id="generatorCreateMessage" class="muted"></div>
      <div class="generator-create-body">
        <div class="row">
          <div class="col">
            <label for="genNameInput">Generator name</label>
            <input id="genNameInput" type="text" placeholder="Elf Names, NPC Traits, Valathi Lexicon..." />
          </div>
          <div class="col">
            <label for="genFolderSelect">Folder</label>
            <select id="genFolderSelect"></select>
            <input
              id="genFolderNewInput"
              type="text"
              placeholder="New folder name"
              style="margin-top:4px; display:none;"
            />
          </div>
          <div class="col">
            <label for="genTypeInput">Type</label>
            <select id="genTypeInput">
              <option value="list">List (simple pool of items)</option>
              <option value="lexicon">Lexicon (english = valathi)</option>
              <option value="advanced">Advanced (patterns & tokens)</option>
            </select>
          </div>
        </div>

        <div id="genItemsRow" class="row">
          <div class="col">
            <label for="genItemsInput">Items / entries</label>
            <textarea
              id="genItemsInput"
              placeholder="For list: one item per line.&#10;For lexicon: english = valathi, one per line."
            ></textarea>
          </div>
        </div>
      </div>
      <div class="row" style="margin-top:6px; justify-content:space-between;">
        <div class="col">
          <button id="expandItemsBtn" class="btn-secondary btn-small" type="button">
            Expand list editor
          </button>
        </div>
        <div class="col" style="text-align:right;">
          <button id="saveGeneratorBtn" class="btn-primary btn-small" type="button">
            Save generator
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Lexicon manage modal -->
  <div id="lexManageBox" class="generator-create-box">
    <div class="generator-create-inner">
      <div class="generator-create-header">
        <div id="lexManageTitle" class="generator-create-title">Manage Lexicon</div>
        <button id="lexManageCloseBtn" class="btn-secondary btn-small" type="button">
          ✕ Close
        </button>
      </div>
      <div id="lexManageMessage" class="muted"></div>
      <div id="lexManageBody" class="generator-create-body"></div>
    </div>
  </div>

  <!-- Advanced template modal -->
  <div id="advTemplateBox" class="generator-create-box">
    <div class="generator-create-inner">
      <div class="generator-create-header">
        <div class="generator-create-title">
          <span id="advTemplateTitle">Edit Template</span>
          <button id="advTemplateHelpBtn" class="btn-secondary btn-small" type="button">?</button>
        </div>
        <button id="advTemplateCloseBtn" class="btn-secondary btn-small" type="button">
          ✕ Close
        </button>
      </div>
      <div id="advTemplateMessage" class="muted"></div>
      <div id="advTemplateBody" class="generator-create-body"></div>
    </div>
  </div>
  
<!-- Core app logic (generators, lexicons, UI) -->
<script src="app.js"></script>

<!-- Tools are ES modules, loaded via main.js -->
<script type="module" src="main.js"></script>

 
</body>
</html>



